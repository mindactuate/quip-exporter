(this.webpackJsonptest=this.webpackJsonptest||[]).push([[0],{1:function(e,t,n){"use strict";var a=n(16),o=Object(a.a)({log:[],addToLog:function(e){o.log.unshift("".concat((new Date).toLocaleString(),": ").concat(e))},clearLog:function(){o.log=[]},quipToken:"",zipFile:null,rootDir:null,exportPaused:!1,exportPausedByUser:!1,donated:!1,running:!1,finished:!1,zipFileFinished:!1,numAPIcalls:0});t.a=o},41:function(e,t,n){},43:function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"startExporting",(function(){return m}));var a=n(6),o=n.n(a),i=n(11),r=n(1),c=n(9),s=n.n(c),d=n(33),l=n(34),u=n.n(l),h=n(68),p=n(70),f=new d.a,j=new u.a,b=new h.LimitWaiter({startWaitingCallback:function(e){console.log(e);var t=0;Object.keys(e).forEach((function(n){n.includes("secondsToWait")&&(t=e[n])}));var n=new Date;r.a.addToLog("Sorry, you have to wait til ".concat(new Date(n.setSeconds(n.getSeconds()+t)).toLocaleTimeString()," (").concat(t," seconds) due to api rate limits of quip.com. More info: ").concat(JSON.stringify(e)))},endWaitingCallback:function(e){return console.log(e)},waitingTickCallback:function(e){return console.log(e)},minutelyLimit:50,hourlyLimit:750,msBetweenTwoCalls:0,test:!1}),g=w((new Date).toLocaleString()),x=[g],m=function(e){e?(r.a.running=!0,r.a.quipToken=e,r.a.addToLog("Got access token: ".concat(e)),r.a.addToLog("Start exporting"),y((function(e){var t=e.shared_folder_ids,n=[];Array.isArray(t)&&t.forEach((function(e){n.push({folder_id:e})}));var a={children:n,folder:{id:"12345",title:"Shared"}},o=e.group_folder_ids,i=[];Array.isArray(o)&&o.forEach((function(e){i.push({folder_id:e})}));var c={children:i,folder:{id:"67890",title:"Group"}};O(e.private_folder_id,(function(e){console.log("loop over private folder docs"),v(e,T,(function(e){console.log("In queue:",b.callbackQueue.length),console.log("loop over shared folders"),v(a,T,(function(e){console.log("In queue:",b.callbackQueue.length),console.log("loop over group folders"),v(c,T,(function(e){r.a.addToLog("Finished exporting"),r.a.addToLog("Used "+b.totalC+" api calls"),r.a.addToLog("Creating zip file"),setTimeout((function(){j.generateAsync({type:"blob"}).then((function(e){r.a.addToLog("Zip file ".concat(g," created")),r.a.zipFile=e,r.a.rootDir=g,r.a.zipFileFinished=!0,r.a.finished=!0,r.a.running=!1}))}),1e4)}))}))}))}))}))):(r.a.addToLog("No access token delivered"),r.a.addToLog("Please deliver access token"),r.a.running=!1)},y=function(){var e=Object(i.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:b.wait((function(){var e="".concat(p.default.quipHost,"users/current");s.a.default.get(e,{headers:{Authorization:"Bearer "+r.a.quipToken}}).then((function(e){if(e&&e.data){var n=e.data;console.log(n),r.a.addToLog("Received user object with the user's name ".concat(n.name)),t(n)}else r.a.addToLog("No user object received")})).catch((function(e){r.a.running=!1,r.a.addToLog("Error while getting user: ".concat(JSON.stringify(e.message))),e.response&&e.response.status&&401===e.response.status&&r.a.addToLog("Your access token seems to be invalid.")}))}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),O=function(){var e=Object(i.a)(o.a.mark((function e(t,n){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:b.wait((function(){var e="".concat(p.default.quipHost,"folders/").concat(t);s.a.default.get(e,{headers:{Authorization:"Bearer "+r.a.quipToken}}).then((function(e){if(e&&e.data){var t=e.data;console.log(t),r.a.addToLog("Start exporting folder with the title ".concat(t.folder.title)),n(t)}else r.a.addToLog("No folder object received")})).catch((function(e){r.a.running=!1,r.a.addToLog("Error while getting folder: ".concat(JSON.stringify(e.message),", try to skip")),n(null),e.response&&e.response.status&&401===e.response.status&&r.a.addToLog("Your access token seems to be invalid.")}))}));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();function v(e,t,n){var a={};if(null!==e){var o=e.folder.id;a[o]=[];var i=0,r=e.children.length,c=w(e.folder.title);x.push(c),r>0?t(e.children[0],(function c(s){s&&a[o].push(s),++i===r?(x.pop(),n(a)):t(e.children[i],c)})):(x.pop(),n(a))}else n(a)}function w(e){var t={"\xe4":"ae","\xfc":"ue","\xf6":"oe","\xdf":"ss","\xc4":"Ae","\xdc":"Ue","\xd6":"Oe"},n=e.replace(/[^A-Za-z0-9\xe4\xf6\xfc\xc4\xd6\xdc\xdf]/gi,"");return n=n.replace(/[\xe4\xf6\xfc\xc4\xd6\xdc\xdf]/g,(function(e){return t[e]}))}function k(){return new Promise((function(e){var t=setInterval((function(){console.log("paused: ".concat(r.a.exportPaused,", paused by User: ").concat(r.a.exportPausedByUser,", running: ").concat(r.a.running)),r.a.exportPaused||r.a.exportPausedByUser||(clearInterval(t),e())}),2e3)}))}function T(e,t){return L.apply(this,arguments)}function L(){return(L=Object(i.a)(o.a.mark((function e(t,n){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(b.totalC>20)||r.a.donated){e.next=10;break}return r.a.numAPIcalls=b.totalC,r.a.exportPaused=!0,r.a.running=!1,r.a.zipFile=null,r.a.addToLog("Creating zip file"),setTimeout((function(){j.generateAsync({type:"blob"}).then((function(e){r.a.addToLog("Zip file ".concat(g,"_demo created")),r.a.zipFile=e,r.a.rootDir=g+"_demo",r.a.zipFileFinished=!0}))}),1e4),e.next=9,k();case 9:r.a.running=!0;case 10:if(!r.a.exportPausedByUser){e.next=17;break}return r.a.zipFile=null,r.a.addToLog("Creating zip file"),setTimeout((function(){j.generateAsync({type:"blob"}).then((function(e){r.a.addToLog("Zip file ".concat(g,"_interim created")),r.a.zipFile=e,r.a.rootDir=g+"_interim",r.a.zipFileFinished=!0}))}),1e4),e.next=16,k();case 16:r.a.running=!0;case 17:t.hasOwnProperty("thread_id")?z(t.thread_id,(function(e){if(null!==e){var a=w(e.thread.title);x.push(a);var o=x.join("/");x.pop(),P(e.html,e.thread.id,a,(function(a){_(o,e.thread.title,a),A(t.thread_id,o),n(t.thread_id)}))}else n(t.thread_id)})):t.hasOwnProperty("folder_id")?O(t.folder_id,(function(e){v(e,T,(function(e){n(e)}))})):n(null);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var z=function(){var e=Object(i.a)(o.a.mark((function e(t,n){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:b.wait((function(){var e="".concat(p.default.quipHost,"threads/").concat(t);s.a.default.get(e,{headers:{Authorization:"Bearer "+r.a.quipToken}}).then((function(e){if(e&&e.data&&e.data.thread){var a=e.data;r.a.addToLog("Start exporting thread with the title ".concat(w(a.thread.title))),n(a)}else r.a.addToLog("Lost thread with the id ".concat(t,", please check with https://platform.quip.com/1/threads/").concat(t))})).catch((function(e){console.log(e),r.a.addToLog("Error while getting thread: ".concat(JSON.stringify(e.message),", try to skip")),n(null),e.response&&e.response.status&&401===e.response.status&&r.a.addToLog("Your access token seems to be invalid.")}))}));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();function P(e,t,n,a){for(var o,i=[],r=/<img.*?src='([^">]*\/([^">]*?))'.*?>/gm;o=r.exec(e);){var c="_images_"+n.substr(0,6)+"_"+t,s=n.substr(0,6)+"_"+i.length+".png";x.push(c),x.push(s);var d=x.join("/");x.pop(),x.pop();var l=c+"/"+s,u=o[1];u=u.substr(1,u.length),i.push({blobPath:u,imageUrl:l,imageFilePath:d}),e=e.replace(o[1],l)}F(i,(function(){a(e)}))}function F(t,n){if(t.length>0){var a=t[0].blobPath,o=t[0].imageFilePath;b.wait((function(){var i=p.default.quipHost+a;s.a.default.get(i,{headers:{Authorization:"Bearer "+r.a.quipToken},responseType:"arraybuffer"}).then((function(a){var i=new e.from(a.data,"binary");j.file(o,i,{binary:!0}),r.a.addToLog("Image ".concat(o," written")),t.shift(),F(t,n)})).catch((function(e){r.a.addToLog("Error while fetching image file ".concat(o)),t.shift(),F(t,n)}))}))}else n()}function A(t,n){t&&b.wait((function(){var a="".concat(p.default.quipHost,"threads/").concat(t,"/export/docx");s.a.default.get(a,{headers:{Authorization:"Bearer "+r.a.quipToken},responseType:"arraybuffer"}).then((function(t){var a=new e.from(t.data,"binary");j.file(n+".docx",a,{binary:!0}),r.a.addToLog("Docx ".concat(n," written"))})).catch((function(e){r.a.addToLog("Error while fetching docx file ".concat(n))}))}))}function _(e,t,n){var a="<!doctype html><html><head><title>"+t+'</title><meta charset="UTF-8"></head><body>';a+=n,a+="</body></html>",j.file(e+".html",a),j.file(e+".md",f.turndown(a)),r.a.addToLog("Documents ".concat(e,".md & .html written"))}}.call(this,n(22).Buffer)},65:function(e,t){},70:function(e,t,n){"use strict";n.r(t);t.default={quipHost:"https://old-rain-a483.mindactuate.workers.dev/?apiurl=https://platform.quip.com/1/"}},71:function(e,t,n){"use strict";n.r(t);var a=n(3),o=n.n(a),i=n(12),r=n.n(i),c=(n(41),n(13)),s=n(14),d=n(19),l=n(18),u=n(16),h=n(1),p=n.p+"static/media/pf_sq_low-res.67450953.jpg",f=n.p+"static/media/Logo_Quip-Exporter.63c2e751.png",j=n.p+"static/media/icon_donate.ef03c9d7.png",b=n(32),g=n(0),x=n(43),m=function(e){Object(d.a)(n,e);var t=Object(l.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"startExporting",value:function(){if(h.a.zipFileFinished=!1,h.a.running||h.a.exportPaused||h.a.exportPausedByUser)h.a.exportPausedByUser&&(h.a.exportPausedByUser=!1,h.a.running=!0);else{h.a.finished=!1;var e=document.getElementById("accesstoken").value;x.startExporting(e)}}},{key:"donateAndContinue",value:function(){window.open("https://paypal.me/mindactuate","_blank"),h.a.donated=!0,h.a.exportPaused=!1}},{key:"downloadZip",value:function(){Object(b.saveAs)(h.a.zipFile,h.a.rootDir)}},{key:"pauseExportingByUser",value:function(){h.a.zipFileFinished=!1,h.a.exportPausedByUser=!0,h.a.running=!1}},{key:"render",value:function(){var e=this;return Object(g.jsxs)("div",{children:[Object(g.jsxs)("div",{id:"container",children:[Object(g.jsxs)("div",{id:"content-left",children:[Object(g.jsx)("h1",{children:"The Quip Exporter"}),Object(g.jsx)("table",{children:Object(g.jsx)("tbody",{children:Object(g.jsxs)("tr",{children:[Object(g.jsx)("td",{valign:"top",children:Object(g.jsx)("img",{src:f,alt:"logo",className:"smallImages"})}),Object(g.jsxs)("td",{valign:"top",children:[Object(g.jsx)("p",{children:"Quip is a great tool to create well formatted documents on desktop as well as on mobile devices. Unfortunately it lacks two important features:"}),Object(g.jsxs)("ol",{children:[Object(g.jsx)("li",{children:"To export all documents at once"}),Object(g.jsx)("li",{children:"To export to html or md including image files"})]}),Object(g.jsx)("p",{children:"This tool will perform a"}),Object(g.jsxs)("ul",{children:[Object(g.jsxs)("li",{children:[Object(g.jsx)("span",{id:"highlight",children:"full export"})," of your Quip account's"," "]}),Object(g.jsxs)("li",{children:[Object(g.jsx)("span",{id:"highlight",children:"private & shared folders"}),"."]})]}),Object(g.jsx)("p",{children:"The files will be exported as"}),Object(g.jsxs)("ul",{children:[Object(g.jsxs)("li",{children:[Object(g.jsx)("span",{id:"highlight",children:"HTML, md & docx"})," files"]}),Object(g.jsxs)("li",{children:[Object(g.jsx)("span",{id:"highlight",children:"including all of your images"}),"."]})]}),Object(g.jsx)("p",{children:"Please keep in mind that it will not loop through your recycle bin and starred folder."})]})]})})}),Object(g.jsx)("h2",{children:"About me and ref to Github"}),Object(g.jsx)("table",{children:Object(g.jsx)("tbody",{children:Object(g.jsxs)("tr",{children:[Object(g.jsx)("td",{valign:"top",children:Object(g.jsx)("img",{src:p,alt:"avatar",className:"smallImages"})}),Object(g.jsx)("td",{valign:"top",children:Object(g.jsxs)("p",{children:["My name is Daniel Gruner, I am a software engineer from Germany. Find me at Github under"," ",Object(g.jsx)("a",{href:"https://github.com/mindactuate",target:"blank",children:"github.com/mindactuate"})," ","or at dev.to under"," ",Object(g.jsx)("a",{href:"https://dev.to/mindactuate",target:"blank",children:"dev.to/mindactuate"}),".",Object(g.jsx)("br",{}),Object(g.jsx)("br",{}),"Or you can send me an email to dnlgrnr911[at]gmail.com.",Object(g.jsx)("br",{}),Object(g.jsx)("br",{}),"You can find the code repository of this app"," ",Object(g.jsx)("a",{href:"https://github.com/mindactuate/quip-exporter",target:"blank",children:"here"}),"."]})})]})})}),Object(g.jsx)("h2",{children:"Impressum and privacy"}),Object(g.jsxs)("p",{children:["You can find the impressum and gdpr privacy in German under"," ",Object(g.jsx)("a",{href:"https://mindactuate.github.io/impressum-datenschutz/",target:"blank",children:"mindactuate.github.io/impressum-datenschutz/"})]})]}),Object(g.jsxs)("div",{id:"content-right",children:[Object(g.jsx)("h2",{children:"Donating"}),Object(g.jsx)("table",{children:Object(g.jsx)("tbody",{children:Object(g.jsxs)("tr",{children:[Object(g.jsx)("td",{valign:"top",children:Object(g.jsx)("a",{href:"https://paypal.me/mindactuate",target:"blank",children:Object(g.jsx)("img",{src:j,alt:"donateIcon",className:"smallImages"})})}),Object(g.jsx)("td",{valign:"top",children:Object(g.jsxs)("p",{children:["This app is a lot of work. Please consider donating just a little. :) You can"," ",Object(g.jsx)("a",{href:"https://paypal.me/mindactuate",target:"blank",children:"paypal me"}),". That\xb4s an effort of 5 seconds."]})})]})})}),Object(g.jsx)("h2",{children:"Access token"}),Object(g.jsxs)("p",{children:["Please get your Quip access token from"," ",Object(g.jsx)("a",{href:"https://quip.com/dev/token",target:"blank",children:"quip.com/dev/token"})," ","and paste it into the form input.",Object(g.jsx)("br",{}),Object(g.jsx)("br",{}),Object(g.jsxs)("s",{children:["You can be sure that your token is used only locally in your web browser and is not transmitted anywhere else but"," ",Object(g.jsx)("a",{href:"https://quip.com/dev/automation/documentation",target:"blank",children:"platform.quip.com"})," ","Therefore you can check the network traffic with help of the developer tools from your browser."]})," ",Object(g.jsx)("b",{style:{color:"red"},children:"Important note:"})," I am currently in contact with Quip to get a CORS trust for my github page. Temporarily I have implemented a Cloudflare cors-proxy as man-in-the-middle. You can find the code for the cors-proxy in my repository. Unfortunately I only have 100.000 free calls per day on Cloudflare. I hope to find a solution with Quip soon."]}),Object(g.jsxs)("div",{id:"tokenform",children:[Object(g.jsx)("label",{children:"Quip Access token"}),Object(g.jsx)("br",{}),Object(g.jsx)("input",{type:"text",id:"accesstoken",name:"accesstoken",style:{width:"100%",height:"30px"},autoComplete:"off"})]}),Object(g.jsx)("h2",{children:"Start exporting"}),Object(g.jsxs)("p",{children:["After hitting the button the exporter starts to export. Please have an eye on the Logs. Depending on how many documents and how many images you have, the export process can last multiple hours or even days. The reason is that Quip limits the number of API requests per minute and per hour for each API token. Please keep this window open and your PC running.",Object(g.jsx)("br",{}),Object(g.jsx)("br",{}),Object(g.jsx)("b",{style:{color:"red"},children:"Do not close or refresh this window / tab while exporting."}),Object(g.jsx)("br",{}),Object(g.jsx)("br",{})," After the export is complete you can download a zip (which is generated and filled by your browser on the run.)"]}),Object(g.jsx)("div",{hidden:h.a.running,children:Object(g.jsx)("input",{type:"button",value:"Start exporting",disabled:h.a.exportPaused,style:{width:"100%",height:"50px"},onClick:function(){return e.startExporting()}})}),Object(g.jsxs)("div",{hidden:!h.a.running,children:[Object(g.jsx)("input",{type:"button",value:"Pause exporting and download zip",style:{width:"100%",height:"50px"},onClick:function(){return e.pauseExportingByUser()}}),Object(g.jsx)("p",{children:Object(g.jsx)("b",{style:{color:"limegreen"},children:"\u25cf Export running"})})]}),Object(g.jsxs)("div",{hidden:!h.a.exportPausedByUser,children:[Object(g.jsx)("p",{children:"Your paused your export. You can download your current zip or continue with exporting."}),Object(g.jsx)("input",{type:"button",disabled:!h.a.zipFileFinished,value:"".concat(h.a.zipFileFinished?"Download zip":"Wait for zip..."),id:"callToAction",onClick:function(){return e.downloadZip()}})]}),Object(g.jsxs)("div",{hidden:!h.a.exportPaused,children:[Object(g.jsxs)("p",{children:["You exported ",Object(g.jsx)("b",{children:h.a.numAPIcalls})," documents and images now. A friendly reminder:"," ",Object(g.jsx)("b",{children:"Please donate just a little."})," You can also download the current zip and have a look at the files."]}),Object(g.jsx)("input",{type:"button",disabled:!h.a.zipFileFinished,value:"".concat(h.a.zipFileFinished?"Download zip":"Wait for zip..."),id:"callToAction",onClick:function(){return e.downloadZip()}}),Object(g.jsx)("input",{type:"button",value:"Donate and continue",id:"callToAction",style:{backgroundColor:"gold"},onClick:function(){return e.donateAndContinue()}})]}),Object(g.jsxs)("div",{hidden:!h.a.finished,children:[Object(g.jsx)("p",{children:"Your export is finished."}),Object(g.jsx)("input",{type:"button",disabled:!h.a.zipFileFinished,value:"".concat(h.a.zipFileFinished?"Download zip":"Wait for zip..."),style:{width:"100%",height:"50px",backgroundColor:"gold"},onClick:function(){return e.downloadZip()}})]})]})]}),Object(g.jsx)("h2",{children:"Log"}),Object(g.jsx)("div",{id:"logarea",children:h.a.log.map((function(e){return Object(g.jsx)("pre",{children:e})}))})]})}}]),n}(o.a.Component),y=Object(u.b)(m);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(Object(g.jsx)(y,{}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[71,1,2]]]);
//# sourceMappingURL=main.5d6053dc.chunk.js.map